
--
-- LibSQL SQL Schema dump automatic generated by geni
--

CREATE TABLE sqlite_sequence(name,seq);
CREATE TABLE schema_migrations (id VARCHAR (255) NOT NULL PRIMARY KEY);
CREATE TABLE users (id INTEGER PRIMARY KEY AUTOINCREMENT, full_name TEXT NOT NULL, email TEXT NOT NULL UNIQUE, password TEXT NOT NULL, role TEXT NOT NULL CHECK (role IN ('student', 'issuer', 'admin')), address TEXT NOT NULL UNIQUE, institution_name TEXT, student_id TEXT, created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, deleted_at TEXT DEFAULT NULL);
CREATE TABLE courses (id INTEGER PRIMARY KEY AUTOINCREMENT, course_name TEXT NOT NULL UNIQUE, course_description TEXT NOT NULL, issuer_id INTEGER NOT NULL, created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, deleted_at TEXT DEFAULT NULL, course_image_url TEXT NOT NULL DEFAULT '', student_emails TEXT NOT NULL DEFAULT '[""]', FOREIGN KEY (issuer_id) REFERENCES users (id) ON DELETE CASCADE);
CREATE TABLE certificates (id INTEGER PRIMARY KEY AUTOINCREMENT, issuer_id INTEGER NOT NULL, student_id INTEGER NOT NULL, student_email TEXT NOT NULL, cert_address TEXT NOT NULL UNIQUE, created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, revoked INTEGER NOT NULL DEFAULT 0, FOREIGN KEY (issuer_id) REFERENCES users (id) ON DELETE CASCADE, FOREIGN KEY (student_id) REFERENCES users (id) ON DELETE CASCADE);
CREATE TABLE sessions (id TEXT PRIMARY KEY, user_id INTEGER NOT NULL, expires INTEGER NOT NULL, FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE);
CREATE TABLE students (id INTEGER PRIMARY KEY AUTOINCREMENT, full_name TEXT NOT NULL UNIQUE, email TEXT NOT NULL UNIQUE, student_address TEXT NOT NULL UNIQUE, created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, deleted_at TEXT DEFAULT NULL, role TEXT NOT NULL DEFAULT 'student' CHECK (role IN ('student', 'admin', 'issuer')));
CREATE TABLE issuer (id INTEGER PRIMARY KEY AUTOINCREMENT, email TEXT NOT NULL UNIQUE, institution_name TEXT NOT NULL UNIQUE, issuer_address TEXT NOT NULL UNIQUE, created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP, deleted_at TEXT DEFAULT NULL, role TEXT NOT NULL DEFAULT 'issuer' CHECK (role IN ('student', 'admin', 'issuer')));
CREATE TABLE certs (id INTEGER PRIMARY KEY AUTOINCREMENT, minted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, cert_hash TEXT, student_id INTEGER REFERENCES users (id) ON DELETE CASCADE, course_id INTEGER REFERENCES courses (id) ON DELETE CASCADE, email TEXT NOT NULL);